local theftCoords = { 
	["AppartmentMiddle"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentMax"] = { 
		["gerItems"] = {  -- aqui é os itens q ganha vasculhando a casa
		["dinheiro-sujo"] = { 25000,40000 },
		["anelroubado"] = { 1,6 },
		["brincoroubado"] = { 4,7 },
		["colarroubado"] = { 2,7 },
		["sapatosroubado"] = { 1,5 },
		["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { -- aqui é os itens q ganha roubando o báu
			["tabletroubado"] = { 5,11 },
		}, 
 	},
	["AppartmentMax2"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentMax3"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentLuxuous"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentLuxuous2"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentLuxuous3"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},

	["AppartmentBasic"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["AppartmentMotel"] = { 
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["dollars2"] = { 5,1 },

		},
 	},
	["Mansion"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["Luxuous"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["Middle"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["Trailer"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
	["Basic"] = {
		["gerItems"] = { 
			["dinheiro-sujo"] = { 25000,40000 },
			["anelroubado"] = { 1,6 },
			["brincoroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["sapatosroubado"] = { 1,5 },
			["relogioroubado"] = { 1,5 },
		},
		["theftVault"] = { 
			["tabletroubado"] = { 5,11 },

		},
 	},
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- AVISAR POLICIA
-----------------------------------------------------------------------------------------------------------------------------------------
local function avisarPolicia(source,homeName, coords)
    local policia = vRP.getUsersByPermission("policia.permissao")
	for l,w in pairs(policia) do
		local player = vRP.getUserSource(parseInt(w))
		if player then 
            async(function()
				vRPC.playSound(player,"Oneshot_Final","MP_MISSION_COUNTDOWN_SOUNDSET")
				TriggerClientEvent("NotifyPush",player,{ code = "Q.R.U", title = "Ocorrência", text = "O Alarme da residência "..homeName.." disparou",  x = coords["x"], y = coords["y"], z = coords["z"], time = "Recebido às "..os.date("%H:%M") })
			end)
		end
    end

	TriggerClientEvent("Notify",source,"Aviso","Você possuí 1 minuto para sair da residência.",6000)
	vCLIENT.exitHouse(source)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIÁVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local homesCooldown = {}
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
cO.theftHouse = function(homeName)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		if homeName then 
			if (homeName):find "Appartament" then 
				TriggerClientEvent("Notify",source,"Aviso","Você só iniciar o assalto em residências privadas.")	
				return 
			end

			local amountCops = vRP.getUsersByPermission("policia.permissao")
			if parseInt(#amountCops) < parseInt(config["minCops"]) then
				TriggerClientEvent("Notify",source,"Aviso","Sistema indisponível no momento, tente mais tarde.",5000)
				return false
			end

			local checkExist = vRP.query("homes/permissions",{ name = homeName })
			if checkExist[1] then
				if homesCooldown[homeName] then 
					TriggerClientEvent("Notify",source,"Aviso","Essa residência foi roubada a pouco tempo, Aguarde <b>"..vRP.getMinSecs(homesCooldown[homeName]).."</b>.")
					return 
				end

				local getItem = (vRP.getInventoryItemAmount(user_id,config["invadeItem"]) >= 1)
				if getItem then 
					local taskResult = vTASKBAR.taskThree(source)
					if taskResult then 
						homesInterior[homeName] = checkExist[1]["interior"]
						local consult = vRP.query("homes/userPermissions",{ name = homeName, user_id = user_id })
						if not consult[1] then
							vRP.tryGetInventoryItem(user_id, config["invadeItem"], 1,true)
							vCLIENT.entranceHomes(source,homeName,homesInterior[homeName],true)
							homesCooldown[homeName] = 3600
						else
							TriggerClientEvent("Notify",source,"Aviso","Você não pode roubar sua própria casa.")
						end
					else
						local tryLockpick = (math.random(0,100) >= 50) 
						if tryLockpick then 
							vRP.tryGetInventoryItem(user_id, config["invadeItem"], 1,true)
						end
					end
				else
					TriggerClientEvent("Notify",source,"Aviso","Você precisa de 1x <b>"..config["invadeItem"].."</b> para iniciar o roubo.")
				end
			else
				TriggerClientEvent("Notify",source,"Aviso","Essa casa não possuí proprietário.")
			end
		end
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- VASCULHAR ITENS
-----------------------------------------------------------------------------------------------------------------------------------------
cO.checkRewards = function(homeName,oneSelect)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		local interior = homesInterior[homeName]
		local coords = GetEntityCoords(GetPlayerPed(source))
		if interior then 
			local rewardedItem = false 
			local taskResult = vTASKBAR.taskTwo(source)
			if taskResult then 
				for k,v in pairs(theftCoords[interior]["gerItems"]) do 
					local checkRandom = math.random(0,100)
					if checkRandom > 50 and not rewardedItem then 
						local amount = math.random(theftCoords[interior]["gerItems"][k][1],theftCoords[interior]["gerItems"][k][2])
						if vRP.getInventoryWeight(user_id)+vRP.getItemWeight(k)*amount <= vRP.getInventoryMaxWeight(user_id) then 
							local rand = math.random(0,100)
							vRP.giveInventoryItem(user_id,k,amount,true)
							rewardedItem = true 
							if rand >= 80 then 
								TriggerClientEvent("Notify",source,"Aviso","O alarme disparou e a polícia foi acionada.")
								TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
								avisarPolicia(source,homeName, {x = homes[homeName][1], y = homes[homeName][2], z = homes[homeName][3] })
							end
						end
					end
				end
			end
			return rewardedItem
		end
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- ROUBAR O BAÚ
-----------------------------------------------------------------------------------------------------------------------------------------
cO.theftVault = function(homeName)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		local checkRobbery = false
		local coords = GetEntityCoords(GetPlayerPed(source))
		if vRP.getInventoryItemAmount(user_id,config["cellphoneItem"]) >= 1 then
			if vRP.tryGetInventoryItem(user_id,config["hackItem"],1,true) then 
				vRPC._CarregarObjeto(source,"amb@world_human_stand_mobile@male@text@enter","enter","prop_amb_phone",50,28422)
				TriggerClientEvent("Notify",source,"Aviso","Se você não conseguir hackear o cofre, o alarme irá disparar.")
				Wait(1000)
				TriggerClientEvent("startMemory",source,{ success = "robberys:Sucess", fail = nil })

				RegisterServerEvent("robberys:Sucess")
				AddEventHandler("robberys:Sucess",function()
					checkRobbery = true
				end)

				local count = 0
				while not checkRobbery do
					count = count + 1
					if count == 30 then
						checkRobbery = false
						TriggerClientEvent("Notify",source,"Aviso","O alarme disparou e a polícia foi acionada.")
						TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
						avisarPolicia(source,homeName, {x = homes[homeName][1], y = homes[homeName][2], z =homes[homeName][3] })
						break
					end
					Citizen.Wait(1000)
				end

				if checkRobbery then
					local interior = homesInterior[homeName]
					for k,v in pairs(theftCoords[interior]["theftVault"]) do
						local amount = math.random(v[1],v[2])
						if vRP.getInventoryWeight(user_id)+vRP.getItemWeight(k)*amount <= vRP.getInventoryMaxWeight(user_id) then
							vRP.giveInventoryItem(user_id,k,amount,true)
						end
					end

					SetTimeout(5000, function()
						local ownerHouses = vRP.query("homes/permissions",{ name = homeName })
						for k,v in pairs(ownerHouses) do 
							local player = vRP.getUserSource(parseInt(v["user_id"]))
							if player then
								async(function()
									TriggerClientEvent("Notify",player,"Aviso","O Alarme da residência <b>"..homeName.."</b> disparou, alguém está roubando sua casa, a polícia foi acionada.")
								end)
							end
						end

						TriggerClientEvent("Notify",source,"Aviso","O Alarme disparou, saia imediatamente")
						TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
						avisarPolicia(source,homeName, {x = homes[homeName][1], y = homes[homeName][2], z = homes[homeName][3] })
						return true
					end)
				end
			else
				TriggerClientEvent("Notify",source,"Aviso","Você precisa de <b>1x Key Card")
			end
		else
			TriggerClientEvent("Notify",source,"Aviso","Você precisa de <b>1x Celular")
		end
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- COUNT COOLDOWN
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread( function()
	while true do
		for k,v in pairs(homesCooldown) do 
			if homesCooldown[k] > 0 then 
				homesCooldown[k] = homesCooldown[k] - 1 
				if homesCooldown[k] == 0 then 
					homesCooldown[k] = nil 
				end
			end
		end
		Citizen.Wait(1000)
	end
end)
