local theftCoords = { 
	["AppartmentMiddle"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentMax"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentMax2"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentMax3"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentLuxuous"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentLuxuous2"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentLuxuous3"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},

	["AppartmentBasic"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["AppartmentMotel"] = { 
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["Mansion"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["Luxuous"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["Middle"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["Trailer"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
	["Basic"] = {
		["gerItems"] = { 
			["relogioroubado"] = { 2,6 },
			["pulseiraroubada"] = { 1,6 },
			["anelroubado"] = { 4,7 },
			["colarroubado"] = { 2,7 },
			["brincoroubado"] = { 1,5 },
			["carteiraroubada"] = { 1,4 },
			["tabletroubado"] = { 2,9 },
			["sapatosroubado"] = { 2,4 },
			["carregadorroubado"] = { 2,8 },
			["vibradorroubado"] = { 3,4 },
			["perfumeroubado"] = { 5,7 },
			["maquiagemroubada"] = { 4,5 },
			["etiqueta"] = { 1,5 },
		},
		["theftVault"] = { 
			["dinheirosujo"] = { 10000,15000 },

		},
 	},
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- AVISAR POLICIA
-----------------------------------------------------------------------------------------------------------------------------------------
local function avisarPolicia(homeName, coords, source, user_id)
    local policia = exports["src_emergency"]:getInservice("policia.permissao")
	for l,w in pairs(policia) do
		local player = vRP.getUserSource(parseInt(w))
		if player then 
            async(function()
				vRPC.playSound(player,"Oneshot_Final","MP_MISSION_COUNTDOWN_SOUNDSET")
				TriggerClientEvent("NotifyPush",player,{ code = 20, title = "Ocorrência", text = "O Alarme do cofre da residência "..homeName.." disparou",  x = coords["x"], y = coords["y"], z = coords["z"], name = "Roubo a residência", rgba = {140,35,35} })
			end)
		end
    end

	
	TriggerClientEvent("Notify",source,"atenção","Você possuí 1 minuto para sair da residência.",6000)
	vCLIENT.exitHouse(source)
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIÁVEIS
-----------------------------------------------------------------------------------------------------------------------------------------
local homesCooldown = {}
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
cO.theftHouse = function(homeName)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		if homeName then 
			if (homeName):find "Apartamento" then 
				TriggerClientEvent("Notify",source,"vermelho","Você só iniciar o assalto em residências privadas.",6000)	
				return 
			end

			local amountCops = exports["src_emergency"]:getInservice("policia.permissao")
			if parseInt(#amountCops) > parseInt(config["minCops"]) then
				TriggerClientEvent("Notify",source,"amarelo","Sistema indisponível no momento, tente mais tarde.",5000)
				return false
			end



			local checkExist = vRP.query("homes/permissions",{ name = homeName })
			if checkExist[1] then
				if homesCooldown[homeName] then 
					TriggerClientEvent("Notify",source,"vermelho","Essa residência foi roubada a pouco tempo, Aguarde <b>"..vRP.getMinSecs(homesCooldown[homeName]).."</b>.",6000)
					return 
				end

				local getItem = (vRP.getInventoryItemAmount(user_id,config["invadeItem"]) >= 1)
				if getItem then 
					local taskResult = vTASKBAR.taskThree(source)
					if taskResult then 
						homesInterior[homeName] = checkExist[1]["interior"]
						local consult = vRP.query("homes/userPermissions",{ name = homeName, user_id = user_id })
						if not consult[1] then
							vRP.tryGetInventoryItem(user_id, config["invadeItem"], 1,true)
							vCLIENT.entranceHomes(source,homeName,homesInterior[homeName],true)
							homesCooldown[homeName] = 3600
						else
							TriggerClientEvent("Notify",source,"vermelho","Você não pode roubar sua própria casa.")
						end
					else
						local tryLockpick = (math.random(0,100) >= 50) 
						if tryLockpick then 
							vRP.tryGetInventoryItem(user_id, config["invadeItem"], 1,true)
						end
					end
				else
					TriggerClientEvent("Notify",source,"vermelho","Você precisa de 1x <b>"..config["invadeItem"].."</b> para iniciar o roubo.",6000)
				end
			else
				TriggerClientEvent("Notify",source,"vermelho","Essa casa não possuí proprietário.",6000)
			end
		end
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- VASCULHAR ITENS
-----------------------------------------------------------------------------------------------------------------------------------------
cO.checkRewards = function(homeName,oneSelect)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		local interior = homesInterior[homeName]
		if interior then 
			local rewardedItem = false 
			local taskResult = vTASKBAR.taskTwo(source)
			if taskResult then 
				local coords = GetEntityCoords(GetPlayerPed(source))
				for k,v in pairs(theftCoords[interior]["gerItems"]) do 
					local checkRandom = math.random(0,100)
					if checkRandom > 50 and not rewardedItem then 
						local amount = math.random(theftCoords[interior]["gerItems"][k][1],theftCoords[interior]["gerItems"][k][2])
						if exports["inventory"]:calculateWeight(user_id,k,amount) then 
							local rand = math.random(0,100)
							vRP.giveInventoryItem(user_id,k,amount,true)
							rewardedItem = true 
							if rand >= 80 then 
								TriggerClientEvent("Notify",source,"vermelho","O alarme disparou e a polícia foi acionada.",6000)
								TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
								avisarPolicia(homeName, {x = homes[homeName][1], y = homes[homeName][2], z = homes[homeName][3] },source,user_id)
							end
						end
					end
				end
			end
			return rewardedItem
		end
	end
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- ROUBAR O BÁU
-----------------------------------------------------------------------------------------------------------------------------------------
cO.theftVault = function(homeName)
	local source = source
	local user_id = vRP.getUserId(source)
	if user_id then 
		local checkRobbery = false
		local coords = GetEntityCoords(GetPlayerPed(source))
		if vRP.getInventoryItemAmount(user_id,config["cellphoneItem"]) >= 1 then
			if vRP.tryGetInventoryItem(user_id, config["hackItem"],1,true) then 
				vRPC._CarregarObjeto(source,"amb@world_human_stand_mobile@male@text@enter","enter","prop_amb_phone",50,28422)
				TriggerClientEvent("Notify",source,"amarelo","Se você não conseguir hackear o cofre, o alarme irá disparar.",6000)
				Wait(1000)
				TriggerClientEvent("startMemory",source,{ success = "robberys:Sucess", fail = nil })

				RegisterServerEvent("robberys:Sucess")
				AddEventHandler("robberys:Sucess",function()
					checkRobbery = true
				end)

				local count = 0
				while not checkRobbery do 
					count = count + 1 
					if count == 30 then 
						checkRobbery = false
						TriggerClientEvent("Notify",source,"vermelho","O alarme disparou e a polícia foi acionada.",6000)
						TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
						avisarPolicia(homeName, {x = homes[homeName][1], y = homes[homeName][2], z = homes[homeName][3] },source,user_id)
						break
					end
					Citizen.Wait(1000)
				end

				if checkRobbery then 
					local interior = homesInterior[homeName]
					for k,v in pairs(theftCoords[interior]["theftVault"]) do 
						local amount = math.random(v[1],v[2]) 
						if exports["inventory"]:calculateWeight(user_id,k,amount) then 
							vRP.giveInventoryItem(user_id,k,amount,true)
						end
					end

					SetTimeout(5000, function()
						local ownerHouses = vRP.query("homes/permissions",{ name = homeName })
						for k,v in pairs(ownerHouses) do 
							local player = vRP.getUserSource(parseInt(v["user_id"]))
							if player then 
								async(function()
									TriggerClientEvent("Notify",player,"vermelho","O Alarme da residência <b>"..homeName.."</b> disparou, alguém está roubando sua casa, a polícia foi acionada.",6000)
								end)
							end
						end

						TriggerClientEvent("Notify",source,"vermelho","O Alarme disparou, saia imediatamente",6000)
						TriggerClientEvent("vrp_sound:fixed",-1,source,coords["x"],coords["y"],coords["z"],100,"alarm",0.5)
						avisarPolicia(homeName, {x = homes[homeName][1], y = homes[homeName][2], z = homes[homeName][3] },source,user_id)
						return true 
					end)
				end
			else
				TriggerClientEvent("Notify",source,"vermelho","Você precisa de <b>1x "..config["hackItem"]..".",6000)
				return false
			end
		end
	end
end

-----------------------------------------------------------------------------------------------------------------------------------------
-- COUNT COOLDOWN
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread( function()
	while true do
		for k,v in pairs(homesCooldown) do 
			if homesCooldown[k] then 
				homesCooldown[k] = homesCooldown[k] - 1 
				if homesCooldown[k] == 0 then 
					homesCooldown[k] = nil 
				end
			end
		end
		Citizen.Wait(1000)
	end
end)
